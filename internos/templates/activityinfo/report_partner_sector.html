{% extends "base.html" %}
{% load staticfiles i18n %}
{% load util_tags %}
{% load static %}

{% block project_title %}Neuro-DB{% endblock %}

{% block content %}
<style>
.table-fixed {
  box-shadow: -5px 7px 8px;
  position: absolute;
  margin-top: 12px;
}
.table thead {
  background-color: #6ad0f9;
  color: white;
}
.w-30 { width: 30px; max-width: 30px;}
.w-50 { width: 50px; max-width: 50px;}
.w-70 { width: 70px; max-width: 70px;}
.w-100 { width: 100px; max-width: 100px;}
.w-120 { width: 120px; max-width: 120px;}
.w-130 { width: 130px; max-width: 130px;}
.w-140 { width: 140px; max-width: 140px;}
.w-150 { width: 150px; max-width: 150px;}
.w-400 { width: 400px; max-width: 400px;}
.w-500 { width: 500px; max-width: 500px;}

.collapse-all.active, .expanded-all.active {
  color: #0089d2;
}
.bootstrap-select button.dropdown-toggle {
   color: white !important;
}
.x_title .bootstrap-select {
  width: 80% !important;
}
.x_title ul li a span {
  color: #000 !important;
}
.x_title ul li a.active span, .x_title ul li a.selected span {
  color: #fff;
}

</style>

<!-- top tiles -->
<div class="row" style="clear: both;">
  <div class="col-md-2 col-sm-4 col-xs-6" style="overflow: unset !important;">
    <h3 style="margin-top: 0px;"><i class="fa fa-filter"></i> Filter by:</h3>
  </div>


  <form action="{% url 'activityinfo:report_partner_sector' %}" method="get">
      <input type="hidden" name="ai_id" value="{{ database.ai_id }}" />
      <input type="hidden" name="indicator_id" value="{{ indicator.id }}" />

      <div class="col-md-2 col-sm-4 col-xs-6" style="overflow: unset !important;" data-step="5" data-intro="Filter options by cadastral">
          <select class="selectpicker show-tick" title="Select a cadastral" name="cadastral" data-style="btn-info" id="filter_govs">
              {% for item in cadastrals %}
                  <option value="{{ item.location_adminlevel_cadastral_area_code }}" {% if item.location_adminlevel_cadastral_area == selected_cadastral %}selected{% endif %}>{{ item.location_adminlevel_cadastral_area }}</option>
              {% endfor %}
          </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-success">Search</button>
      </div>

      <div class="col-md-3 col-sm-4 col-xs-6" style="overflow: unset !important;" data-step="6" data-intro="If you need any assistance, here you can find the ActivityInfo database's focal point">

        <i class="fa fa-user faa-pulse animated-hover" data-toggle="tooltip" data-placement="bottom" data-html="true"
           title="Database focal point: {{ database.focal_point }} <br/>
                  email: {{ database.focal_point.email }} <br/>" style="font-size: 25px;"> {{ database.focal_point.first_name }} </i>
        <a href="mailto:{{ database.focal_point.email }}?subject=ActivityInfo: Inquiry about {{ database.label }} database" data-toggle="tooltip" data-placement="bottom"
           title="Send email to the database focal point" style="padding-left: 20px;">
          <i class="fa fa-envelope-o faa-pulse animated-hover" style="font-size: 25px; color: #0089d2"></i>
        </a>

        <a class="" href="javascript:void(0);" onclick="javascript:introJs().setOption('showProgress', true).start();" data-toggle="tooltip" data-placement="bottom"
           title="Show me some tips" style="padding-left: 20px;">
          <i class="fa fa-lightbulb-o" style="font-size: 30px; color: #0089d2"></i>
        </a>

      </div>

  </form>

</div>

<!-- /top tiles -->
<div class="row">
  <div class="w-1002 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>
                      <strong>Dashboard - {{ database.label }} - 2019</strong>
                    </h2>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_title">
                    <form action="{% url 'activityinfo:report_partner_sector' %}" method="get">
                        <input type="hidden" name="ai_id" value="{{ database.ai_id }}" />
                        <input type="hidden" name="governorate" value="{{ selected_governorate }}" />

                        <div class="col-md-10 col-sm-4 col-xs-6" style="overflow: unset !important;" data-step="57" data-intro="Go to specific Indicator">
                            <select class="selectpicker show-tick" data-style="btn-primary" data-live-search="true" name="indicator_id" id="filter_indicator">
                              {% for item in indicators %}
                                <option value="{{ item.id }}" {% if item.id == selected_indicator %}selected{% endif %}>{{ item.name }}</option>
                              {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2">
                          <button type="submit" class="btn btn-success">Go</button>
                        </div>
                    </form>
                    <div class="clearfix"></div>
                  </div>

                  <div class="x_content" style="">

                    <table id="exporttable1" content="{{ database.reporting_year.name }}_{{ database.label }}_Dashboard.csv"
                           data-tableName="Dashboard - {{ database.label }} - 2019"
                           class="table table-striped table-bordered">
                      <thead>
                        <tr>
                          <th style="vertical-align: middle;">Partner</th>
                          {% for month, month_name in months %}
                            <th>{{ month_name }}</th>
                          {% endfor %}
                        </tr>
                      </thead>
                      <tbody>
                        {% for partner in partners %}
                          <tr>
                            <th>{{ partner.partner_label }}</th>
                              {% for month, month_name in months %}
                                <td>
                                  {% get_indicator_value_sector indicator month partner.partner_id selected_governorate as value %}
                                  {{ value }}
                                </td>
                              {% endfor %}
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>

                  <div class="x_content" style="">

                    <table id="exporttable2" content="{{ database.reporting_year.name }}_{{ database.label }}_Dashboard.csv"
                           data-tableName="Dashboard - {{ database.label }} - 2019"
                           class="table table-striped table-bordered">
                      <thead>
                        <tr>
                          <th style="vertical-align: middle;">Cadastral</th>
                          {% for month, month_name in months %}
                            <th>{{ month_name }}</th>
                          {% endfor %}
                        </tr>
                      </thead>
                      <tbody>
                        {% for cada in cadastrals %}
                          <tr>
                            <th>{{ cada.location_adminlevel_cadastral_area }}</th>
                              {% for month, month_name in months %}
                                <td>
                                  {% get_indicator_value_sector indicator month selected_partner cada.location_adminlevel_cadastral_area_code as value %}
                                  {{ value }}
                                </td>
                              {% endfor %}
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
        </div>
  </div>

</div>
<br />


{% endblock content %}

{% block extra_js %}
  <script src="{% static 'vendors/jquery-quicksearch/jquery.quicksearch.js' %}"></script>
  <script src="//cdn.rawgit.com/rainabba/jquery-table2excel/1.1.0/dist/jquery.table2excel.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.10/dist/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.10/dist/js/bootstrap-select.min.js"></script>

<script>

$(document).ready(function(){

    $('#filter_indicator').selectpicker();
});
</script>

{% endblock %}
